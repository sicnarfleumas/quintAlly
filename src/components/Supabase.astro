---
import { createClient } from '@supabase/supabase-js'

// Use a try-catch block to handle potential missing environment variables
let supabase;
try {
  const supabaseUrl = import.meta.env.PUBLIC_SUPABASE_URL
  const supabaseAnonKey = import.meta.env.PUBLIC_SUPABASE_ANON_KEY

  if (!supabaseUrl || !supabaseAnonKey) {
    throw new Error('Missing Supabase environment variables')
  }

  supabase = createClient(supabaseUrl, supabaseAnonKey)
} catch (error) {
  console.error('Error initializing Supabase client:', error)
  // Set supabase to null if initialization fails
  supabase = null
}
---

<form id="myForm">
  <input type="text" name="name" placeholder="Name" required>
  <input type="email" name="email" placeholder="Email" required>
  <button type="submit">Submit</button>
</form>

<script>
  import { createClient } from '@supabase/supabase-js'

  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('myForm') as HTMLFormElement | null;

    if (form) {
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const formData = new FormData(form);
        const name = formData.get('name') as string;
        const email = formData.get('email') as string;

        try {
          const supabaseUrl = import.meta.env.PUBLIC_SUPABASE_URL;
          const supabaseAnonKey = import.meta.env.PUBLIC_SUPABASE_ANON_KEY;

          if (!supabaseUrl || !supabaseAnonKey) {
            throw new Error('Missing Supabase environment variables');
          }

          const supabase = createClient(supabaseUrl, supabaseAnonKey);

          const { error } = await supabase
            .from('submissions')
            .insert([{ name, email }]);

          if (error) throw error;
          
          alert('Form submitted successfully!');
          form.reset();
        } catch (error) {
          console.error('Error submitting form:', error);
          alert('An error occurred while submitting the form.');
        }
      });
    } else {
      console.error('Form element not found');
    }
  });
</script>